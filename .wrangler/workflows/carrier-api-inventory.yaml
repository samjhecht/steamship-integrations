name: carrier-api-inventory
version: 2

defaults:
  model: opus
  permissionMode: bypassPermissions
  settingSources: ["project"]

safety:
  maxStepTimeoutMs: 600000
  failOnStepError: true

phases:
  - name: research
    agent: researcher
    prompt: research-carrier
    model: opus
    output: research

  - name: inventory
    agent: implementer
    prompt: fill-inventory
    input: research
    output: inventory

  - name: verify
    agent: inventory-reviewer
    prompt: verify-inventory
    input: inventory
    output: review

  - name: fix
    agent: implementer
    prompt: fix-inventory-gaps
    input: review
    condition: review.hasGaps

  - name: publish
    agent: implementer
    prompt: publish-inventory
    input: inventory
